# serial
```https://github.com/ctfs/write-ups-2016/tree/master/codegate-ctf-2016/pwn/serial-444```  
## 概要  
ありがちなheap領域を使ったメモかと思いきや、挙動が少し特殊。  
最初に謎のプロダクトキーの入力を求められるが、こっちは本質ではないのでangrに投げた。  
## 解法
heapを使うのでUAFやdouble freeを使うのかと思いきやそうではなかった。  
使える脆弱性(?)はdumpを選択した時にheap上に存在する関数ポインタからdumpの処理を呼び出している挙動(call RDX)に存在し、addの時に入力する名前をオーバーフローさせる事でこのポインタが書き換え可能になるというもの。  
これによって任意の関数を呼び出せるようになる。  
(ただしlibcをリークしていないので、呼び出せる関数はpltにあるもののみである)  
これを利用してprintf@pltを呼び出す。  
第一引数となるRDIレジスタにはaddで入力したバッファへのポインタが入っているのでFSBができるようになる。  
gdbを使ってdump内でcall RDXする前のスタックを見てみると、%19\$に該当する部分に```__libc_start_main+240```のアドレスが入っているので、これをリークさせる。  
これによってlibc baseを算出する事ができるようになるので、そこから計算して得たsystem関数を呼び出す。  